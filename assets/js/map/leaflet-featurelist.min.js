/*
* Leaflet Feature List version 1.0.0
* 
* Copyright 2022 Cecilia Palmer 
* mail@ceciliapalmer.studio
* https://ceciliapalmer.studio
*
* This program is free software: you can redistribute it and/or modify it under the terms 
* of the GNU General Public License as published by the Free Software Foundation, version 3 or later.
* This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; 
* without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. 
* See the GNU General Public License for more details.

* You should have received a copy of the GNU General Public License along with this program. If not, see https://www.gnu.org/licenses/.
*
*/

function listItemFunctionDefault(t,e){return L.DomUtil.create("h3","",t).innerHTML=e.name,t}L.Control.FeatureList=L.Control.extend({options:{position:"topleft",layer:!1,title:!1,featureName:"name",classname:"leaflet-control-feature-list",listItemFunction:listItemFunctionDefault},initialize:function(t){L.Util.setOptions(this,t),this._container=null,this._list=null,this._layer=this.options.layer||new L.LayerGroup},onAdd:function(t){this._map=t;const e=L.DomUtil.create("div",this.options.classname);this._container=e;const i=this._layer.getLayers().length;if(this.options.title){const t=L.DomUtil.create("div","result-group-headline",e);t.innerHTML=`${this.options.title} (${i})`,i>4&&(t.classList.add("collapsible","collapsed"),t.addEventListener("click",(t=>{t.target.classList.toggle("hidden")})))}if(this._list=L.DomUtil.create("div","result-inner",e),L.DomEvent.on(e,"mousewheel",L.DomEvent.stopPropagation),L.DomEvent.disableScrollPropagation(e),0==i){L.DomUtil.create("p","no-result-message",this._list).innerHTML="Unfortunately there are no services we can show you for the selected options :("}else this.updateList();if(i>4){const t=L.DomUtil.create("div","btn btn-outline-primary show-all",e);t.textContent="Show all",L.DomEvent.on(t,"click",(t=>{t.target.parentNode.querySelector(".result-group-headline").classList.toggle("collapsed")}))}return e},_getItem:function(t){return t},_createItem:function(t){if(t.feature.properties.hasOwnProperty(this.options.featureName)){const e=t.item=L.DomUtil.create("div","listItem");return t.feature.properties.hasOwnProperty("serviceArt")&&"Online"==t.feature.properties.serviceArt&&e.classList.add("online-service"),L.DomEvent.on(e,"click",(function(i){if(this.goToItem(e,t),featureLayer.resetStyle(),"undefined"!=typeof geojsonLayers&&geojsonLayers.forEach((t=>t.resetStyle())),!t.feature.properties.hasOwnProperty("serviceArt")||"Online"!=t.feature.properties.serviceArt)if(t.setStyle(activeStyle).bringToFront(),"undefined"!=typeof paddingLeft)this._map.flyTo(t.getLatLng(),15,{paddingTopLeft:[paddingLeft,0]});else{let e=window.innerWidth<768?0:document.querySelector(".leaflet-top.leaflet-left").width;this._map.flyTo(t.getLatLng(),15,{paddingTopLeft:[e,0]})}}),this).on(t,"click",(()=>{this.goToItem(e,t)})),this.options.listItemFunction(e,t.feature),e}},goToItem:function(t,e){this._list.querySelectorAll(".active").forEach((e=>{e!==t&&e.classList.toggle("active")})),t.classList.contains("active")||t.classList.toggle("active"),"undefined"!=typeof geojsonLayers&&this._container.parentNode.querySelectorAll(".active").forEach((e=>{e!==t&&e.classList.toggle("active")}));const i=t.offsetTop+1;this._container.scrollTo({top:i,left:0,behavior:"smooth"})},updateList:function(){const t=this;if(L.DomUtil.empty(this._list),this.options.randomOrder){let e=[];this._layer.eachLayer((function(i){const o=t._createItem(i);e.push(o)})),e=e.sort(((t,e)=>.5-Math.random())),e.forEach((e=>t._list.appendChild(e)))}else this._layer.eachLayer((e=>{const i=t._createItem(e);t._list.appendChild(i)}))},_moveTo:function(t){this._map.setView(t,Math.max(this._map.getZoom(),15))}}),L.control.featurelist=function(t){return new L.Control.FeatureList(t)};